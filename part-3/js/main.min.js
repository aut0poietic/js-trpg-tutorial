var trpg={GRID:50,MAX_TILES_W:20,MAX_TILES_H:10,FPS:60,viewport:{width:0,height:0,top:0,left:0},bounds:{top:0,left:0,bottom:0,right:0},classes:{}};trpg.Utilities={perf_test:function(e,t,n){"use strict";console.time(n);e.call(t);console.timeEnd(n)},getRandomInt:function(e,t){"use strict";return Math.floor(Math.random()*(t-e+1))+e}};trpg.Utilities.CArray=function(e,t){"use strict";this.NCOLS=e;this.NROWS=t;this.__vals=[]};trpg.Utilities.CArray.prototype={get:function(e,t){"use strict";return this.__vals[e*this.NCOLS+t]},set:function(e,t,n){"use strict";this.__vals[e*this.NCOLS+t]=n}};trpg.Board=function(e){"use strict";this.x=0;this.y=0;this.gridX=0;this.gridY=0;this.tiles=undefined;this.initialize(e)};trpg.Board.prototype=_.extend(new createjs.Container,{initialize:function(e){"use strict";_.bindAll(this);trpg.bounds.bottom=Math.floor(e.height/trpg.GRID)-1;trpg.bounds.right=Math.floor(e.width/trpg.GRID)-1;this.render(e);this.cursor=new trpg.Cursor;this.addChild(this.cursor);this.tiles=new trpg.Utilities.CArray(20,40);window.onkeydown=_.throttle(this.onKeyPress,100)},render:function(e){"use strict";var t=new createjs.Container,n=new createjs.Bitmap(e),r=new createjs.Shape;t.x=t.y=r.x=r.y=n.x=n.y=0;r.graphics.beginFill(createjs.Graphics.getRGB(255,255,255,.4));for(var i=trpg.GRID;i<=e.width;i+=trpg.GRID)r.graphics.drawRect(i,0,1,e.height);for(i=trpg.GRID;i<e.height;i+=trpg.GRID)r.graphics.drawRect(0,i,e.width,1);t.addChild(n);t.addChild(r);t.cache(0,0,e.width,e.height);this.addChild(t)},onKeyPress:function(e){"use strict";if(e.keyCode>=37&&e.keyCode<=40){this.cursor.onKeyPress(e);this.position();return!1}},position:function(){"use strict";var e={top:this.gridY+1,left:this.gridX+1,bottom:this.gridY+trpg.viewport.height-1,right:this.gridX+trpg.viewport.width-1};this.cursor.gridY<e.top?this.gridY=Math.max(trpg.bounds.top,this.gridY-1):this.cursor.gridY>e.bottom&&(this.gridY=Math.min(trpg.bounds.bottom-trpg.viewport.height,this.gridY+1));this.cursor.gridX<e.left?this.gridX=Math.max(trpg.bounds.left,this.gridX-1):this.cursor.gridX>e.right&&(this.gridX=Math.min(trpg.bounds.right-trpg.viewport.width,this.gridX+1));this.x=this.gridX*trpg.GRID*-1;this.y=this.gridY*trpg.GRID*-1}});window.onload=function(){"use strict";if(trpg&&trpg.Engine){trpg.instance=new trpg.Engine;trpg.instance.initialize();window.focus()}};